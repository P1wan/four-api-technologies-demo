<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOAP Client - Streaming Service</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --soap-primary: #f39c12;
            --soap-secondary: #e67e22;
            --soap-success: #27ae60;
            --soap-danger: #e74c3c;
            --soap-dark: #2c3e50;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            margin: 20px;
            padding: 0;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--soap-primary), var(--soap-secondary));
            color: white;
            padding: 20px 30px;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .status-bar {
            background: rgba(var(--soap-dark), 0.1);
            padding: 15px 30px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-online {
            background: var(--soap-success);
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.5);
        }

        .status-offline {
            background: var(--soap-danger);
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .metrics-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid var(--soap-primary);
        }

        .operation-section {
            padding: 30px;
        }

        .operation-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--soap-primary);
            transition: all 0.3s ease;
        }

        .operation-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .operation-title {
            color: var(--soap-dark);
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .operation-title i {
            margin-right: 10px;
            color: var(--soap-primary);
        }

        .btn-soap {
            background: linear-gradient(135deg, var(--soap-primary), var(--soap-secondary));
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(243, 156, 18, 0.3);
        }

        .btn-soap:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(243, 156, 18, 0.4);
            color: white;
        }

        .btn-soap:active {
            transform: translateY(0);
        }

        .response-viewer {
            height: 400px;
            border: 2px solid var(--soap-primary);
            border-radius: 10px;
            background: #f8f9fa;
            overflow-y: auto;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            position: relative;
        }

        .response-viewer::before {
            content: 'SOAP Response';
            position: absolute;
            top: 10px;
            right: 15px;
            background: var(--soap-primary);
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
        }

        .form-control:focus {
            border-color: var(--soap-primary);
            box-shadow: 0 0 0 0.2rem rgba(243, 156, 18, 0.25);
        }

        .input-group {
            margin-bottom: 15px;
        }

        .accordion-button {
            background: var(--soap-primary);
            color: white;
            font-weight: 600;
        }

        .accordion-button:not(.collapsed) {
            background: var(--soap-secondary);
            color: white;
        }

        .accordion-button:focus {
            box-shadow: 0 0 0 0.25rem rgba(243, 156, 18, 0.25);
        }

        .badge-soap {
            background: var(--soap-primary);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin-left: 10px;
        }

        .quick-actions {
            background: rgba(var(--soap-primary), 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .quick-actions .btn {
            margin: 5px;
        }

        @media (max-width: 768px) {
            .main-container {
                margin: 10px;
            }
            
            .operation-section {
                padding: 15px;
            }
            
            .response-viewer {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-container">
            <!-- Header -->
            <div class="header">
                <div class="header-content">
                    <h1 class="mb-2">
                        <i class="fas fa-soap"></i>
                        SOAP Client - Streaming Service
                    </h1>
                    <p class="mb-0 opacity-75">
                        <i class="fas fa-music"></i>
                        Simple Object Access Protocol for Music Streaming API
                    </p>
                </div>
            </div>

            <!-- Status Bar -->
            <div class="status-bar">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <span class="status-indicator" id="serverStatus"></span>
                        <span id="statusText" class="fw-bold">Verificando status do servidor...</span>
                        <span class="badge-soap" id="wsdlStatus">WSDL</span>
                    </div>
                    <div class="col-md-6">
                        <div class="metrics-card mb-0">
                            <div class="row text-center">
                                <div class="col-3">
                                    <div class="fw-bold text-primary" id="requestCount">0</div>
                                    <small>Requisições</small>
                                </div>
                                <div class="col-3">
                                    <div class="fw-bold text-success" id="successCount">0</div>
                                    <small>Sucessos</small>
                                </div>
                                <div class="col-3">
                                    <div class="fw-bold text-danger" id="errorCount">0</div>
                                    <small>Erros</small>
                                </div>
                                <div class="col-3">
                                    <div class="fw-bold text-info" id="avgTime">0ms</div>
                                    <small>Tempo Médio</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="row g-0">
                <!-- Operations Panel -->
                <div class="col-lg-6">
                    <div class="operation-section">
                        <!-- Quick Actions -->
                        <div class="quick-actions">
                            <h6 class="mb-3">
                                <i class="fas fa-bolt"></i>
                                Ações Rápidas
                            </h6>
                            <button class="btn btn-soap btn-sm" onclick="listarUsuarios()">
                                <i class="fas fa-users"></i> Usuários
                            </button>
                            <button class="btn btn-soap btn-sm" onclick="listarMusicas()">
                                <i class="fas fa-music"></i> Músicas
                            </button>
                            <button class="btn btn-soap btn-sm" onclick="obterEstatisticas()">
                                <i class="fas fa-chart-bar"></i> Estatísticas
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="clearResponse()">
                                <i class="fas fa-eraser"></i> Limpar
                            </button>
                        </div>

                        <!-- Operations Accordion -->
                        <div class="accordion" id="operationsAccordion">
                            <!-- Query Operations -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#queryOperations">
                                        <i class="fas fa-search me-2"></i>
                                        Operações de Consulta
                                    </button>
                                </h2>
                                <div id="queryOperations" class="accordion-collapse collapse show">
                                    <div class="accordion-body">
                                        
                                        <!-- List Users -->
                                        <div class="operation-card">
                                            <h6 class="operation-title">
                                                <i class="fas fa-users"></i>
                                                Listar Usuários
                                            </h6>
                                            <p class="text-muted mb-3">Lista todos os usuários cadastrados no sistema</p>
                                            <button class="btn btn-soap" onclick="listarUsuarios()">
                                                <i class="fas fa-play"></i> Executar
                                            </button>
                                        </div>

                                        <!-- List Songs -->
                                        <div class="operation-card">
                                            <h6 class="operation-title">
                                                <i class="fas fa-music"></i>
                                                Listar Músicas
                                            </h6>
                                            <p class="text-muted mb-3">Lista todas as músicas disponíveis</p>
                                            <button class="btn btn-soap" onclick="listarMusicas()">
                                                <i class="fas fa-play"></i> Executar
                                            </button>
                                        </div>

                                        <!-- User Playlists -->
                                        <div class="operation-card">
                                            <h6 class="operation-title">
                                                <i class="fas fa-list"></i>
                                                Playlists do Usuário
                                            </h6>
                                            <p class="text-muted mb-3">Lista playlists de um usuário específico</p>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="userId" 
                                                       placeholder="ID do Usuário (ex: user1)">
                                                <button class="btn btn-soap" onclick="listarPlaylistsUsuario()">
                                                    <i class="fas fa-search"></i> Buscar
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Playlist Songs -->
                                        <div class="operation-card">
                                            <h6 class="operation-title">
                                                <i class="fas fa-compact-disc"></i>
                                                Músicas da Playlist
                                            </h6>
                                            <p class="text-muted mb-3">Lista músicas de uma playlist específica</p>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="playlistId" 
                                                       placeholder="ID da Playlist (ex: playlist1)">
                                                <button class="btn btn-soap" onclick="listarMusicasPlaylist()">
                                                    <i class="fas fa-search"></i> Buscar
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Song Playlists -->
                                        <div class="operation-card">
                                            <h6 class="operation-title">
                                                <i class="fas fa-search-plus"></i>
                                                Playlists com Música
                                            </h6>
                                            <p class="text-muted mb-3">Lista playlists que contêm uma música</p>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="musicId" 
                                                       placeholder="ID da Música (ex: music1)">
                                                <button class="btn btn-soap" onclick="listarPlaylistsComMusica()">
                                                    <i class="fas fa-search"></i> Buscar
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Statistics -->
                                        <div class="operation-card">
                                            <h6 class="operation-title">
                                                <i class="fas fa-chart-bar"></i>
                                                Estatísticas do Serviço
                                            </h6>
                                            <p class="text-muted mb-3">Obtém estatísticas gerais do sistema</p>
                                            <button class="btn btn-soap" onclick="obterEstatisticas()">
                                                <i class="fas fa-analytics"></i> Obter Estatísticas
                                            </button>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <!-- CRUD Operations -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                            data-bs-target="#crudOperations">
                                        <i class="fas fa-plus-circle me-2"></i>
                                        Operações de Criação (CRUD)
                                    </button>
                                </h2>
                                <div id="crudOperations" class="accordion-collapse collapse">
                                    <div class="accordion-body">

                                        <!-- Create User -->
                                        <div class="operation-card">
                                            <h6 class="operation-title">
                                                <i class="fas fa-user-plus"></i>
                                                Criar Usuário
                                            </h6>
                                            <div class="mb-3">
                                                <input type="text" class="form-control mb-2" id="novoUsuarioId" 
                                                       placeholder="ID único do usuário">
                                                <input type="text" class="form-control mb-2" id="novoUsuarioNome" 
                                                       placeholder="Nome completo">
                                                <input type="number" class="form-control mb-2" id="novoUsuarioIdade" 
                                                       placeholder="Idade" min="1" max="120">
                                                <button class="btn btn-soap" onclick="criarUsuario()">
                                                    <i class="fas fa-plus"></i> Criar Usuário
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Create Song -->
                                        <div class="operation-card">
                                            <h6 class="operation-title">
                                                <i class="fas fa-music"></i>
                                                Criar Música
                                            </h6>
                                            <div class="mb-3">
                                                <input type="text" class="form-control mb-2" id="novaMusicaId" 
                                                       placeholder="ID único da música">
                                                <input type="text" class="form-control mb-2" id="novaMusicaNome" 
                                                       placeholder="Nome da música">
                                                <input type="text" class="form-control mb-2" id="novaMusicaArtista" 
                                                       placeholder="Nome do artista">
                                                <input type="number" class="form-control mb-2" id="novaMusicaDuracao" 
                                                       placeholder="Duração em segundos" min="1">
                                                <button class="btn btn-soap" onclick="criarMusica()">
                                                    <i class="fas fa-plus"></i> Criar Música
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Create Playlist -->
                                        <div class="operation-card">
                                            <h6 class="operation-title">
                                                <i class="fas fa-list-alt"></i>
                                                Criar Playlist
                                            </h6>
                                            <div class="mb-3">
                                                <input type="text" class="form-control mb-2" id="novaPlaylistId" 
                                                       placeholder="ID único da playlist">
                                                <input type="text" class="form-control mb-2" id="novaPlaylistNome" 
                                                       placeholder="Nome da playlist">
                                                <input type="text" class="form-control mb-2" id="novaPlaylistUsuario" 
                                                       placeholder="ID do usuário proprietário">
                                                <input type="text" class="form-control mb-2" id="novaPlaylistMusicas" 
                                                       placeholder="IDs das músicas (separados por vírgula)">
                                                <button class="btn btn-soap" onclick="criarPlaylist()">
                                                    <i class="fas fa-plus"></i> Criar Playlist
                                                </button>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Response Panel -->
                <div class="col-lg-6">
                    <div class="operation-section">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4 class="mb-0">
                                <i class="fas fa-terminal"></i>
                                Resposta SOAP
                            </h4>
                            <div>
                                <button class="btn btn-outline-secondary btn-sm" onclick="clearResponse()">
                                    <i class="fas fa-eraser"></i> Limpar
                                </button>
                                <button class="btn btn-outline-info btn-sm" onclick="formatResponse()">
                                    <i class="fas fa-code"></i> Formatar
                                </button>
                            </div>
                        </div>
                        
                        <div class="response-viewer" id="responseViewer">
                            <div class="text-center text-muted mt-5">
                                <i class="fas fa-inbox fa-3x mb-3 opacity-50"></i>
                                <p>Nenhuma resposta ainda.<br>Execute uma operação para ver o resultado.</p>
                                <small>💡 Use Ctrl+1, Ctrl+2, Ctrl+3 para ações rápidas</small>
                            </div>
                        </div>

                        <!-- SOAP Message Inspector -->
                        <div class="mt-3">
                            <div class="accordion">
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                                data-bs-target="#soapInspector">
                                            <i class="fas fa-search me-2"></i>
                                            Inspetor de Mensagens SOAP
                                        </button>
                                    </h2>
                                    <div id="soapInspector" class="accordion-collapse collapse">
                                        <div class="accordion-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <h6>📤 Última Requisição</h6>
                                                    <pre id="lastRequest" class="bg-light p-2 rounded" style="font-size: 12px; height: 200px; overflow-y: auto;"></pre>
                                                </div>
                                                <div class="col-md-6">
                                                    <h6>📥 Última Resposta</h6>
                                                    <pre id="lastResponse" class="bg-light p-2 rounded" style="font-size: 12px; height: 200px; overflow-y: auto;"></pre>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Metrics -->
                        <div class="mt-3">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-tachometer-alt"></i>
                                        Métricas de Performance
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <canvas id="performanceChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="bg-light p-3 mt-4">
                <div class="row">
                    <div class="col-md-6">
                        <h6>🔗 Links Úteis</h6>
                        <ul class="list-unstyled mb-0">
                            <li><a href="?wsdl" target="_blank">📄 Visualizar WSDL</a></li>
                            <li><a href="http://localhost:8000/docs" target="_blank">🔵 REST API (FastAPI)</a></li>
                            <li><a href="http://localhost:8001/graphql" target="_blank">🟣 GraphQL (GraphiQL)</a></li>
                            <li><a href="http://localhost:8080" target="_blank">🌐 Página Principal</a></li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>⌨️ Atalhos de Teclado</h6>
                        <ul class="list-unstyled mb-0">
                            <li><kbd>Ctrl+1</kbd> Listar usuários</li>
                            <li><kbd>Ctrl+2</kbd> Listar músicas</li>
                            <li><kbd>Ctrl+3</kbd> Obter estatísticas</li>
                            <li><kbd>Ctrl+R</kbd> Limpar resposta</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="client.js"></script>

    <script>
        // Enhanced functionality
        let performanceChart;
        let chartData = {
            labels: [],
            datasets: [{
                label: 'Tempo de Resposta (ms)',
                data: [],
                borderColor: '#f39c12',
                backgroundColor: 'rgba(243, 156, 18, 0.1)',
                tension: 0.4
            }]
        };

        // Initialize chart
        function initPerformanceChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Tempo (ms)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Requisições'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // Update chart with new data
        function updatePerformanceChart(operation, responseTime) {
            const now = new Date();
            const label = `${operation} (${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')})`;
            
            chartData.labels.push(label);
            chartData.datasets[0].data.push(responseTime);
            
            // Keep only last 10 entries
            if (chartData.labels.length > 10) {
                chartData.labels.shift();
                chartData.datasets[0].data.shift();
            }
            
            performanceChart.update();
        }

        // Format response function
        function formatResponse() {
            const viewer = document.getElementById('responseViewer');
            if (viewer && viewer.textContent) {
                try {
                    const formatted = JSON.stringify(JSON.parse(viewer.textContent), null, 2);
                    viewer.textContent = formatted;
                } catch (e) {
                    // If not JSON, try to format as XML
                    console.log('Not JSON, keeping as-is');
                }
            }
        }

        // Enhanced display functions
        const originalDisplayResponse = window.displayResponse;
        window.displayResponse = function(data, operation = '') {
            originalDisplayResponse(data, operation);
            
            // Update performance chart if we have timing info
            if (client && client.metrics.requestCount > 0) {
                const avgTime = client.metrics.totalTime / client.metrics.requestCount;
                updatePerformanceChart(operation, Math.round(avgTime));
            }
        };

        // Auto-fill test data
        function fillTestData() {
            // Generate random IDs
            const userId = 'user_' + Math.random().toString(36).substr(2, 5);
            const musicId = 'music_' + Math.random().toString(36).substr(2, 5);
            const playlistId = 'playlist_' + Math.random().toString(36).substr(2, 5);

            // Fill user form
            document.getElementById('novoUsuarioId').value = userId;
            document.getElementById('novoUsuarioNome').value = 'Usuário Teste';
            document.getElementById('novoUsuarioIdade').value = '25';

            // Fill music form
            document.getElementById('novaMusicaId').value = musicId;
            document.getElementById('novaMusicaNome').value = 'Música Teste';
            document.getElementById('novaMusicaArtista').value = 'Artista Teste';
            document.getElementById('novaMusicaDuracao').value = '180';

            // Fill playlist form
            document.getElementById('novaPlaylistId').value = playlistId;
            document.getElementById('novaPlaylistNome').value = 'Playlist Teste';
            document.getElementById('novaPlaylistUsuario').value = 'user1';
            document.getElementById('novaPlaylistMusicas').value = 'music1,music2';
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initPerformanceChart();
            
            // Add test data button
            const quickActions = document.querySelector('.quick-actions');
            if (quickActions) {
                const testDataBtn = document.createElement('button');
                testDataBtn.className = 'btn btn-outline-info btn-sm';
                testDataBtn.innerHTML = '<i class="fas fa-flask"></i> Dados Teste';
                testDataBtn.onclick = fillTestData;
                quickActions.appendChild(testDataBtn);
            }
        });

        // Status indicator animation
        function animateStatusIndicator() {
            const indicator = document.getElementById('serverStatus');
            if (indicator && indicator.classList.contains('status-online')) {
                indicator.style.animation = 'pulse 2s infinite';
            }
        }

        // Call animation every 5 seconds
        setInterval(animateStatusIndicator, 5000);
    </script>
</body>
</html>